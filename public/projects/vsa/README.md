# ⚡ VSA (Visual Search Analysis System) 系統

## 📘 專案概述

**VSA** 是一個基於 **PySide6**
的半導體缺陷分析與可視化系統，專門用於半導體製造流程中的缺陷檢測、分析與互動式可視化，提供
**完整的數據管理、圖像處理** 與 **缺陷比較** 工具。

------------------------------------------------------------------------

## 🚀 主要功能

### 🔍 1. 數據搜索與預覽

-   🏷 **產品類型選擇**：支援多種產品分析
-   🆔 **Lot ID / Component ID 搜索**：快速定位特定批次與組件
-   🖼 **即時圖像預覽**：支援 PNG、TIFF、JPG 等多種格式
-   📦 **PKG NO 搜索**：依封裝元件編號快速查找

### 🧠 2. 缺陷分析工具

-   🗺 **ROI (Region of Interest) 分析**：互動式散點圖顯示缺陷分布
-   🏗 **多層級缺陷比較**：站點(1~N)等層級分析
-   🏷 **缺陷類型分類**：自動分類與標記不同缺陷類型
-   📊 **缺陷統計**：提供數量分布、變化趨勢

### 🖥 3. 圖像處理與可視化

-   🎯 **互動式散點圖**：支援點擊查看詳細資訊
-   🪟 **多視圖對比**：多個圖像同時顯示以進行比對
-   🎨 **自訂地圖**：自訂顏色、標題、圖例
-   💾 **圖像導出**：支援 PNG、TIFF 格式

### ⚖️ 4. 數據比較功能

-   ⬇ **垂直比較**：層級間缺陷變化對比
-   ➡ **水平比較**：不同組件之間的缺陷分布
-   📈 **良率分析**：自動計算垂直良率
-   🔄 **變化率計算**：趨勢分析

------------------------------------------------------------------------

## 🗂 專案結構

    VSA/
    ├── main.py                  # 程式入口
    ├── ui.py                    # 主介面
    ├── search.py                # 基礎搜索功能
    ├── search2.py               # 圖像搜索與開啟
    ├── plot.py                  # 互動式散點圖
    ├── download.py              # 檔案下載
    ├── map_download.py          # 散點圖下載
    ├── calculate_change.py       # 缺陷變化率計算
    ├── calculate_vertical_yield.py # 垂直良率分析
    ├── compare_horizontal.py     # 水平比較
    ├── compare_vertical.py       # 垂直比較
    ├── customize_map_plot.py     # 自訂缺陷繪製
    ├── customize_map_ui.py       # 自訂缺陷介面
    ├── lossmap_plot.py           # 損失缺陷繪製
    ├── lossmap_ui.py             # 損失缺陷介面
    ├── button_names.json         # 按鈕名稱配置
    └── rule.json                 # 缺陷分類規則

------------------------------------------------------------------------

## 🛠 技術棧

  技術               用途
  ------------------ ------------------------------
  **PySide6**        GUI 介面框架 (Qt for Python)
  **Plotly**         互動式數據可視化
  **Pandas**         數據處理與分析
  **Pillow**         圖像處理
  **Flask / Dash**   Web 介面與可視化

------------------------------------------------------------------------

## 📦 安裝需求

``` bash
pip install -r requirements.txt
```

------------------------------------------------------------------------

## ▶ 使用說明

### 1️⃣ 啟動系統

``` bash
python main.py
```

### 2️⃣ 操作流程

1.  選擇產品類型 (PRODUCT1 / PRODUCT2  / PRODUCT3/....  )
2.  輸入 Lot ID 與 Component ID
3.  設定地圖大小、點大小等參數
4.  點擊 **Search** 進行數據檢索
5.  選擇 ROI 分析、垂直或水平比較等功能
6.  在預覽視窗中查看與導出結果

------------------------------------------------------------------------

## 📊 主要功能詳解

### ROI 分析

-   點擊 **Roi** 按鈕顯示散點圖
-   支援點擊查看缺陷圖像與多層級對比

### 缺陷比較

-   **垂直比較**：不同層級間缺陷變化
-   **水平比較**：同層級不同組件缺陷分布
-   **良率分析**：計算 FPY (First Pass Yield)

### 自訂地圖

-   可調整地圖顏色、大小、圖例顯示
-   支援互動式篩選

### 數據導出

-   可導出地圖、原始圖像、CSV 統計數據

------------------------------------------------------------------------

## 📁 資料夾結構

    D:/Database-PC/
    ├── {產品類型}/
    │   ├── map/       # 地圖檔
    │   ├── csv/       # 數據檔
    │   ├── roi/       # ROI 圖片
    │   ├── org/       # 原始圖片
    │   ├── bar/       # 條形圖
    │   └── example/   # 示例圖片

------------------------------------------------------------------------

## ⚙ 配置檔案

### button_names.json

``` json
{
  "PRODUCT1": ["STEP1", "LOSS1", "STEP2", "LOSS2", "STEP3", "LOSS3", "STEP4", "LOSS4", "STEP5", "LOSS5", "STEP6", "LOSS6", "STEP7", "FPY"],
  "PRODUCT2": [...],
  "PRODUCT3": [...]
}
```

### rule.json

定義缺陷分類規則，用於自動分類缺陷。

------------------------------------------------------------------------

## 🧪 注意事項

1.  確保資料夾結構正確
2.  CSV 必須包含 **Col / Row / DefectType** 欄位
3.  避免 Dash 端口衝突 (5000-9000)
4.  大量數據需注意記憶體使用

------------------------------------------------------------------------

## 🔧 開發擴展

-   支援更多產品類型
-   新增 AI 缺陷識別模型
-   增加 Web 版報表自動生成
-   支援更多數據格式

------------------------------------------------------------------------

## 📌 版本資訊

-   **版本**：6.0
-   **開發環境**：Python 3.8+
-   **依賴**：見安裝需求

------------------------------------------------------------------------


